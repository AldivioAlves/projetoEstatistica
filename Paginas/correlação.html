<!DOCTYPE html>
<html>

<head>
    <meta charset="utf8" />
    <LINK href="../bootstrap-4.1.3-dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
</head>
<style type="text/css">
    .valoresVariaveis {
        display: inline
    }

    #nomeIndependente,
    #nomeDependente {
        display: inline
    }
    #divCanvas{
        width: 70%;
        height: 70%;
        border:2px solid black;
        margin-left: auto;
        margin-right: auto
    }
</style>

<body>
    <div id="divCanvas">
    <canvas id='grafico'></canvas>
    </div>
    <p class="valoresVariaveis" id='nomeIndependente'>

    </p>
    <input type="text" size=30 id='VarIndependente' onclick="document.getElementById('VarDependente').value=''" />
    <button onclick="projeções()">Projetar</button>

    <input type="text" size="30" id='VarDependente' onclick="document.getElementById('VarIndependente').value=''" />
    <p class="valoresVariaveis" id=nomeDependente>

    </p>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js"></script>

<style href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css"></style>


<script>
    VtoP = function (n) {

        for (j = 0; j < n.length; j++) {
            if (n[j] == ',') {
                n = n.replace(n[j], '.')

            }
        }
        return n
    }


    x = JSON.parse(window.localStorage.getItem('dadosCorrelação')).x
    y = JSON.parse(window.localStorage.getItem('dadosCorrelação')).y
    nomeX = document.getElementById('nomeIndependente').innerText = JSON.parse(window.localStorage.getItem('dadosCorrelação')).nomeX
    nomeY = document.getElementById('nomeDependente').innerText = JSON.parse(window.localStorage.getItem('dadosCorrelação')).nomeY


    //acumuladores 

    acX = 0
    acY = 0
    acXpow = 0
    acYpow = 0
    acXxY = 0

    for (i = 0; i < x.length; i++) {
        acX += x[i]
        acY += y[i]
        acXpow += Math.pow(x[i], 2)
        acYpow += Math.pow(y[i], 2)
        acXxY += x[i] * y[i]
    }
    //numero dupla x y pesquisada
    n = x.length

    //formula r

    r = (n * acXxY - acX * acY) / Math.sqrt((n * acXpow - Math.pow(acX, 2)) * (n * acYpow - Math.pow(acY, 2)))

    //constantes

    a = (n * acXxY - acX * acY) / (n * acXpow - Math.pow(acX, 2))
    b = (acY / n) - a * (acX / n)

    // pontos para o grafico

    vetorPontos = []
    objetoPonto = {}
    for (i=0;i<x.length;i++){
        objetoPonto['x']=x[i]
        objetoPonto['y']=y[i]
        vetorPontos.push(objetoPonto)
        objetoPonto={}
    }

    // inicio da reta do grafico 
    //maior valor para x e y

    maiorX = x[0]
    for (i=0;i<x.length;i++){
        if(x[i]>maiorX){
            maiorX=x[i]
            
        }
    }
    maiorY=y[0]
    for(i=0;i<y.length;i++){
        if (y[i]>maiorY){
            maiorY=y[i]
        }

    }
    projeçãoY = a*(maiorX)+b

    IeFlinha = [{x:0,y:b},{x:maiorX,y:projeçãoY}]

    projeções = function () {
        varX = VtoP(document.getElementById('VarIndependente').value)
        if (isNaN(varX)) {
            alert('Dados incorretos!\nDigite um numero na entrada da variavel ' + nomeX)
            return
        }


        varY = VtoP(document.getElementById('VarDependente').value)
        if (isNaN(varY)) {
            alert('Dados incorretos!\nDigite um numero na entrada da variavel ' + nomeY)
            return
        }



        if (varX != '') {
            idVar = 'VarDependente'
            calculoProjeção = a * parseFloat(varX) + b
        }
        if (varY != '') {
            idVar = 'VarIndependente'
            calculoProjeção = (parseFloat(varY) - b) / a

        }
        document.getElementById(idVar).value = calculoProjeção

    }



</script>
<script src="../Scripts/graficoTeste.js"></script>
</html>